{% extends "webapp/base_app.html" %}
{% block title %}Panel administrador{% endblock %}
{% block content %}
<div class="mt-4">
  <div class="row">
    <div class="col-md-4">
      <div class="card text-bg-primary mb-3">
        <div class="card-body">
          <h5 class="card-title">Asistencias de {{ nombre_mes }}</h5>
          <p class="display-6">{{ asistencias_mes }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-bg-danger mb-3">
        <div class="card-body">
          <h5 class="card-title">Alumnos sin pago</h5>
          <p class="display-6">{{ morosos|length }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-bg-warning mb-3">
        <div class="card-body">
          <h5 class="card-title">Boletas pendientes</h5>
          <p class="display-6">{{ boletas_pendientes }}</p>
        </div>
      </div>
    </div>
  </div>

  <div class="row text-center mb-4">
    <div class="col-md-3 mb-2">
      <a class="btn btn-lg btn-outline-success w-100" href="{% url 'webapp:asistencias_list' %}">
        <i class="bi bi-clipboard-plus"></i><span class="d-none d-md-inline ms-1">Agregar asistencia</span>
      </a>
    </div>
    <div class="col-md-3 mb-2">
      <a class="btn btn-lg btn-outline-primary w-100" href="{% url 'webapp:sesiones_list' %}">
        <i class="bi bi-calendar3"></i><span class="d-none d-md-inline ms-1">Sesiones</span>
      </a>
    </div>
    <div class="col-md-3 mb-2">
      <a class="btn btn-lg btn-outline-primary w-100" href="{% url 'webapp:estudiantes_list' %}">
        <i class="bi bi-people"></i><span class="d-none d-md-inline ms-1">Estudiantes</span>
      </a>
    </div>
    <div class="col-md-3 mb-2">
      <a class="btn btn-lg btn-outline-primary w-100" href="{% url 'webapp:pagos_list' %}">
        <i class="bi bi-cash"></i><span class="d-none d-md-inline ms-1">Pagos</span>
      </a>
    </div>
  </div>

  <h2 class="mb-3">Asistencias de {{ nombre_mes }}</h2>
  <div class="card mb-4">
    <div class="card-body table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Taller</th>
            <th>Profesores</th>
            <th>Asistentes</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for sesion in sesiones_resumen %}
          <tr>
            <td>{{ sesion.fecha }}</td>
            <td>{{ sesion.disciplina }}</td>
            <td>
              {% if sesion.profesores.all %}
                {% for profe in sesion.profesores.all %}
                  {{ profe }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
              {% else %}
                -
              {% endif %}
            </td>
            <td>{{ sesion.total_asistentes }}</td>
            <td>
              <a class="btn btn-sm btn-outline-secondary" href="{% url 'webapp:sesion_detail' sesion.pk %}">
                <i class="bi bi-eye"></i><span class="d-none d-md-inline ms-1">Ver sesion</span>
              </a>
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="5" class="text-center text-muted">Sin registros este mes.</td></tr>
          {% endfor %}
        </tbody>
      </table>
      <a class="btn btn-outline-primary btn-sm" href="{% url 'webapp:asistencias_list' %}">
        <i class="bi bi-clipboard-check"></i><span class="d-none d-md-inline ms-1">Ir a asistencias</span>
      </a>
    </div>
  </div>

  <h2 class="mb-3">Finanzas alumnos</h2>
  <div class="card mb-4">
    <div class="card-body table-responsive">
      <table class="table table-sm">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Alumno</th>
            <th>Monto</th>
          </tr>
        </thead>
        <tbody>
          {% for pago in pagos_recientes %}
          <tr>
            <td>{{ pago.fecha_pago }}</td>
            <td>{{ pago.persona }}</td>
            <td>${{ pago.monto }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="3" class="text-center text-muted">Sin pagos recientes.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <h2 class="mb-3">Finanzas profesores</h2>
  <div class="card mb-4">
    <div class="card-body table-responsive">
      <table class="table table-sm">
        <thead>
          <tr>
            <th>Profesor</th>
            <th>Periodo</th>
            <th>Neto</th>
          </tr>
        </thead>
        <tbody>
          {% for liq in liquidaciones_recientes %}
          <tr>
            <td>{{ liq.profesor }}</td>
            <td>{{ liq.periodo_inicio }} - {{ liq.periodo_fin }}</td>
            <td>${{ liq.monto_neto }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="3" class="text-center text-muted">Sin liquidaciones recientes.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
